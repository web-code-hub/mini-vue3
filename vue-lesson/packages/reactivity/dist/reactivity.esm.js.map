{
  "version": 3,
  "sources": ["../../shared/src/index.ts", "../src/effect.ts", "../src/reactiveEffect.ts", "../src/baseHandle.ts", "../src/reactive.ts", "../src/ref.ts"],
  "sourcesContent": ["export function isObject(value){\r\n    return typeof value === 'object' && value !== null\r\n}", "class ReactiveEffect {\r\n    public active = true // \u662F\u5426\u6FC0\u6D3B\r\n    public _trackId = 0; // effect\u6807\u8BC6\r\n    public _depsLength = 0; // \u4F9D\u8D56\u957F\u5EA6\r\n    public _running = false;\r\n    public deps = [] // \u4F9D\u8D56\u96C6\u5408\r\n    constructor(public fn, public scheduler?) { }\r\n    run() {\r\n        if (!this.active) this.fn() // \u975E\u6FC0\u6D3B\u72B6\u6001\u76F4\u63A5\u6267\u884C\u51FD\u6570\r\n        let lastActiveEffect = activeEffect // \u5907\u4EFD\u4E0A\u4E00\u4E2A\u6FC0\u6D3B\u7684effect\r\n        try {\r\n            activeEffect = this // \u5F53\u524D\u6FC0\u6D3B\u7684effect\r\n            perCleanupEffect(this) // \u6E05\u9664\u4F9D\u8D56\r\n            this._running = true\r\n            return this.fn()\r\n        } finally {\r\n            postCleanupEffect(this)\r\n            this._running = false\r\n            activeEffect = lastActiveEffect // \u6062\u590D\u4E0A\u4E00\u4E2A\u6FC0\u6D3B\u7684effect\r\n        }\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * \r\n * @param effect // effect\u5B9E\u4F8B\r\n */\r\nfunction perCleanupEffect(effect) {\r\n    effect._depsLength = 0\r\n    effect._trackId++;\r\n}// \u6E05\u9664\u4F9D\u8D56\r\n\r\n/**\r\n * \r\n * @param effect \u6FC0\u6D3B\u7684effect\r\n */\r\nfunction postCleanupEffect(effect) { // \u6062\u590D\u4F9D\u8D56\r\n    if(effect.deps.length > effect._depsLength){ // \u5220\u9664\u591A\u4F59\u7684\u4F9D\u8D56\r\n        for (let i = effect._depsLength; i < effect.deps.length; i++) {\r\n            cleanEffect(effect.deps[i],effect)\r\n        }\r\n        effect.deps.length = effect._depsLength // \u622A\u53D6\u4F9D\u8D56\r\n    }\r\n}   \r\n/**\r\n * \r\n * @param dep // \u8981\u5220\u9664\u7684\u4F9D\u8D56\r\n * @param effect // \u5220\u9664\u7684\u4F9D\u8D56\u7684effect\r\n */\r\nfunction cleanEffect(dep, effect) { \r\n    dep.delete(effect)\r\n    if(dep.size === 0) dep.cleanDep()\r\n\r\n} // \u6E05\u9664\u4F9D\u8D56\r\n\r\nexport let activeEffect; // \u5F53\u524D\u6FC0\u6D3B\u7684effect\r\n\r\n/**\r\n * \r\n * @param fn // \u8981\u6267\u884C\u7684\u51FD\u6570\r\n * @param options // \u9009\u9879\r\n */\r\nexport function effect(fn: Function, options?) { // \u521B\u5EFAeffect\r\n    const _effect = new ReactiveEffect(fn, () => { // \u8C03\u5EA6\u5668\r\n        _effect.run() // \u6267\u884Ceffect\r\n    })\r\n    _effect.run()\r\n    if(options){\r\n        Object.assign(_effect,options)\r\n    }\r\n    const runner = _effect.run.bind(_effect) // \u521B\u5EFA runner\r\n    runner.effect = _effect // \u7ED1\u5B9Aeffect\r\n    return runner // \u8FD4\u56DE runner\r\n}\r\n\r\n/**\r\n * \r\n * @param effect // effect \u5B9E\u4F8B\r\n * @param dep  // \u4F9D\u8D56\r\n */\r\n\r\nexport function trackEffects(effect, dep) {\r\n    if(dep.get(effect)!==effect._trackId){ // \u907F\u514D\u91CD\u590D\u6536\u96C6\r\n        dep.set(effect,effect._trackId) // \u6DFB\u52A0\u4F9D\u8D56\r\n        const oldDep = effect.deps[effect._depsLength] // \u83B7\u53D6\u8001\u7684\u4F9D\u8D56\r\n        if(oldDep !== dep){ // \u907F\u514D\u91CD\u590D\u6DFB\u52A0\r\n            if(oldDep){ // \u6E05\u7406\u8001\u7684\u4F9D\u8D56\r\n                cleanEffect(oldDep,effect)\r\n            }\r\n            effect.deps[effect._depsLength++] = dep // \u91CD\u65B0\u6DFB\u52A0\u4F9D\u8D56\r\n        }else{\r\n            effect._depsLength++ // \u4F9D\u8D56\u957F\u5EA6\u81EA\u589E\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * \r\n * @param dep \u4F9D\u8D56\r\n */\r\n\r\nexport function triggerEffect(dep) {\r\n    for (const effect of dep.keys()) {\r\n        if(!effect._running){\r\n            if(effect.scheduler){\r\n                effect.scheduler()\r\n            }\r\n        }\r\n    }\r\n}\r\n", "import { activeEffect, trackEffects, triggerEffect } from \"./effect\";\r\nconst targetMap = new WeakMap() // \u5B58\u50A8\u4F9D\u8D56\r\n\r\nexport const  createDep = (cleanDep,key) =>{\r\n    const dep = new Map() as any\r\n    dep.cleanDep = cleanDep\r\n    dep.name = key\r\n    return dep;\r\n}\r\nexport function track(target, key) {\r\n    if (activeEffect) { // \u6709\u6FC0\u6D3B\u7684effect\u624D\u6536\u96C6\u4F9D\u8D56\r\n        let depsMap = targetMap.get(target) // \u83B7\u53D6\u5BF9\u8C61\u7684\u4F9D\u8D56\r\n        if (!depsMap) { // \u6CA1\u6709\u4F9D\u8D56\u5C31\u521B\u5EFA\u4E00\u4E2A\r\n            targetMap.set(target, depsMap = new Map()) // \u521B\u5EFA\u5BF9\u8C61\u7684\u4F9D\u8D56\r\n        }\r\n        let dep = depsMap.get(key) // \u83B7\u53D6\u5C5E\u6027\u7684\u4F9D\u8D56           \r\n        if (!dep) { // \u6CA1\u6709\u4F9D\u8D56\u5C31\u521B\u5EFA\u4E00\u4E2A\r\n            depsMap.set(\r\n                key, \r\n                dep = createDep(() => depsMap.delete(key), key) // \u521B\u5EFA\u5C5E\u6027\u7684\u4F9D\u8D56\r\n            )\r\n        }\r\n        trackEffects(activeEffect,dep) // \u6536\u96C6\u4F9D\u8D56\r\n    }else {\r\n        return false\r\n    }\r\n}\r\n\r\nexport function trigger(target,key){\r\n    const depsMap = targetMap.get(target) // \u83B7\u53D6\u5BF9\u8C61\u7684\u4F9D\u8D56\r\n    if(!depsMap) return false; // \u6CA1\u6709\u4F9D\u8D56\u76F4\u63A5\u8FD4\u56DE\r\n    const dep = depsMap.get(key) // \u83B7\u53D6\u5C5E\u6027\u7684\u4F9D\u8D56\r\n    if(!dep) return false; // \u6CA1\u6709\u4F9D\u8D56\u76F4\u63A5\u8FD4\u56DE  \r\n    triggerEffect(dep) // \u89E6\u53D1\u66F4\u65B0\r\n}\r\n", "import { isObject } from \"@vue/shared\";\r\nimport { track, trigger } from \"./reactiveEffect\";\r\nimport { reactive } from \"./reactive\";\r\nexport enum ReactiveFlags { // \u54CD\u5E94\u5F0F\u6807\u8BC6\r\n    IS_REACTIVE = '__v_isReactive'\r\n}\r\n/**\r\n * \u521B\u5EFA\u4EE3\u7406\u5BF9\u8C61\r\n */\r\nexport const mutabaleHandlers: ProxyHandler<object> = {\r\n    get(target, key, receiver) {\r\n        if (key === ReactiveFlags.IS_REACTIVE) true // \u54CD\u5E94\u5F0F\u6807\u8BC6\r\n        const result = Reflect.get(target, key, receiver) // \u83B7\u53D6\u5C5E\u6027\u503C\r\n\r\n\r\n        track(target, key) // \u6536\u96C6\u4F9D\u8D56\r\n        if (isObject(result)) reactive(result) // \u5982\u679C\u5C5E\u6027\u503C\u662F\u5BF9\u8C61\u5C31\u8FDB\u884C\u4EE3\u7406\r\n        return result // \u901A\u8FC7Reflect\u83B7\u53D6\u503C\r\n    },\r\n    set(target, key, value, recetiver) { // \u8BBE\u7F6E\u503C\r\n        // \u89E6\u53D1\u66F4\u65B0\r\n        const oldValue = target[key]\r\n        const result = Reflect.set(target, key, value, recetiver) // \u901A\u8FC7Reflect\u8BBE\u7F6E\u503C\r\n        if (oldValue !== value) {\r\n            trigger(target, key) // \u89E6\u53D1\u66F4\u65B0\r\n        }\r\n        return result\r\n    }\r\n}", "import { isObject } from \"@vue/shared\";\r\nimport { mutabaleHandlers, ReactiveFlags } from \"./baseHandle\";\r\nconst reactiveMap = new WeakMap(); // key:target value:proxy\r\n\r\n\r\nexport function reactive(target) { // \u54CD\u5E94\u5F0F\u51FD\u6570\r\n    return createReactive(target);\r\n}\r\nfunction createReactive(target) { // \u521B\u5EFA\u54CD\u5E94\u5F0F\u51FD\u6570\r\n    !isObject && target // \u4E0D\u662F\u5BF9\u8C61\u76F4\u63A5\u8FD4\u56DE\r\n    target[ReactiveFlags.IS_REACTIVE] && target // \u5DF2\u7ECF\u662F\u54CD\u5E94\u5F0F\u5BF9\u8C61\u76F4\u63A5\u8FD4\u56DE\r\n\r\n    const existingProxy = reactiveMap.get(target) // \u5DF2\u7ECF\u88AB\u4EE3\u7406\u8FC7\u76F4\u63A5\u8FD4\u56DE\r\n    existingProxy && existingProxy // \u7F13\u5B58\u4E2D\u6709\u76F4\u63A5\u8FD4\u56DE\r\n\r\n    const proxy = new Proxy(target, mutabaleHandlers) // \u521B\u5EFA\u4EE3\u7406\r\n    reactiveMap.set(target, proxy) // \u7F13\u5B58\u4EE3\u7406\r\n    return proxy // \u8FD4\u56DE\u4EE3\u7406\r\n}\r\nexport function toReactive(value) {\r\n    return isObject(value) ? reactive(value) : value\r\n}", "import { activeEffect, trackEffects, triggerEffect } from \"./effect\";\r\nimport { toReactive } from \"./reactive\";\r\nimport { createDep } from \"./reactiveEffect\";\r\n\r\n/**\r\n * \r\n * @param value //\u503C\r\n * @returns    // ref\u5BF9\u8C61\r\n */\r\nexport function ref(value) {\r\n    return createRef(value)\r\n}\r\nfunction createRef(value) {\r\n    return new RefImpl(value)\r\n}\r\nclass RefImpl {\r\n    public _v_isRef = true\r\n    public _value;\r\n    public dep\r\n    constructor(public rawValue) {\r\n        this._value = toReactive(rawValue)\r\n    }\r\n    get value() {\r\n        trackRef(this)\r\n        return this._value\r\n    }\r\n    set value(newValue) {\r\n        if (newValue !== this.rawValue) {\r\n            this.rawValue = newValue\r\n            this._value = newValue\r\n            triggerRef(this)\r\n        }\r\n    }\r\n}\r\nclass ObjectRefImpl {\r\n    constructor(public object, public key) { }\r\n    get value() {\r\n        return this.object[this.key]\r\n    }\r\n    set(value) {\r\n        this.object[this.key] = value\r\n    }\r\n}\r\nfunction trackRef(ref) {\r\n    activeEffect && trackEffects(activeEffect, ref.dep = createDep(() => (ref.dep = undefined), 'undefined'))\r\n\r\n}\r\nfunction triggerRef(ref) {\r\n    ref.dep && triggerEffect(ref.dep)\r\n}\r\n\r\nexport function toRef(object, key) {\r\n    return new ObjectRefImpl(object, key)\r\n}\r\n\r\nexport function toRefs(object) {\r\n    const result = {}\r\n    for (const key in object) {\r\n        result[key] = toRef(object, key)\r\n    }\r\n    return result\r\n}\r\n\r\nexport function proxyRefs(objectWhthRefs){\r\n    return new Proxy(objectWhthRefs,{\r\n        get(target,key,receiver){\r\n            return Reflect.get(target,key,receiver)\r\n        },\r\n        set(target,key,value,redeceiver){\r\n            const oldValue = target[key]\r\n            if(oldValue._v_isRef){\r\n                oldValue.value = value\r\n                return true\r\n            }else{\r\n                return Reflect.set(target,key,value,redeceiver)\r\n            }\r\n        }\r\n    })\r\n}\r\n\r\n"],
  "mappings": "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",
  "names": ["effect", "ref"]
}
