{
  "version": 3,
  "sources": ["../../shared/src/index.ts", "../src/effect.ts", "../src/reactiveEffect.ts", "../src/baseHandle.ts", "../src/reactive.ts"],
  "sourcesContent": ["export function isObject(value){\r\n    return typeof value === 'object' && value !== null\r\n}", "class ReactiveEffect {\r\n    public active = true // \u662F\u5426\u6FC0\u6D3B\r\n    public _trackId = 0; // effect\u6807\u8BC6\r\n    public _depsLength = 0; // \u4F9D\u8D56\u957F\u5EA6\r\n    public deps = [] // \u4F9D\u8D56\u96C6\u5408\r\n    constructor(public fn, public scheduler?) { }\r\n    run() {\r\n        if (!this.active) this.fn() // \u975E\u6FC0\u6D3B\u72B6\u6001\u76F4\u63A5\u6267\u884C\u51FD\u6570\r\n        let lastActiveEffect = activeEffect // \u5907\u4EFD\u4E0A\u4E00\u4E2A\u6FC0\u6D3B\u7684effect\r\n        try {\r\n            activeEffect = this // \u5F53\u524D\u6FC0\u6D3B\u7684effect\r\n            perCleanupEffect(this) // \u6E05\u9664\u4F9D\u8D56\r\n            return this.fn()\r\n        } finally {\r\n            activeEffect = lastActiveEffect // \u6062\u590D\u4E0A\u4E00\u4E2A\u6FC0\u6D3B\u7684effect\r\n        }\r\n    }\r\n}\r\n\r\nfunction perCleanupEffect(effect) {\r\n    effect._depsLength = 0\r\n    effect._trackId++;\r\n}// \u6E05\u9664\u4F9D\u8D56\r\n\r\nfunction cleanEffect(dep, effect) {\r\n    dep.delete(effect)\r\n    if(dep.size === 0) dep.cleanDep()\r\n\r\n} // \u6E05\u9664\u4F9D\u8D56\r\n\r\nexport let activeEffect; // \u5F53\u524D\u6FC0\u6D3B\u7684effect\r\nexport function effect(fn: Function, options?) { // \u521B\u5EFAeffect\r\n    const _effect = new ReactiveEffect(fn, () => { // \u8C03\u5EA6\u5668\r\n        _effect.run() // \u6267\u884Ceffect\r\n    })\r\n    _effect.run() // \u7ACB\u5373\u6267\u884C\r\n}\r\n\r\nexport function trackEffects(effect, dep) {\r\n    if(dep.get(effect)!==effect._trackId){ // \u907F\u514D\u91CD\u590D\u6536\u96C6\r\n        dep.set(effect,effect._trackId) // \u6DFB\u52A0\u4F9D\u8D56\r\n        const oldDep = effect.deps[effect._depsLength] // \u83B7\u53D6\u8001\u7684\u4F9D\u8D56\r\n        if(oldDep !== dep){ // \u907F\u514D\u91CD\u590D\u6DFB\u52A0\r\n            if(oldDep){ // \u6E05\u7406\u8001\u7684\u4F9D\u8D56\r\n                cleanEffect(oldDep,effect)\r\n            }\r\n            effect.deps[effect._depsLength++] = dep // \u91CD\u65B0\u6DFB\u52A0\u4F9D\u8D56\r\n        }else{\r\n            effect._depsLength++ // \u4F9D\u8D56\u957F\u5EA6\u81EA\u589E\r\n        }\r\n    }\r\n}\r\n\r\nexport function triggerEffect(dep) {\r\n    for (const effect of dep.keys()) {\r\n        effect.scheduler && effect.scheduler()  // \u89E6\u53D1\u66F4\u65B0\r\n    }\r\n}\r\n", "import { create } from \"domain\";\r\nimport { activeEffect, trackEffects, triggerEffect } from \"./effect\";\r\nconst targetMap = new WeakMap() // \u5B58\u50A8\u4F9D\u8D56\r\n\r\nexport const  createDep = (cleanDep,key) =>{\r\n    const dep = new Map() as any\r\n    dep.cleanDep = cleanDep\r\n    dep.name = key\r\n    return dep;\r\n}\r\nexport function track(target, key) {\r\n    if (activeEffect) { // \u6709\u6FC0\u6D3B\u7684effect\u624D\u6536\u96C6\u4F9D\u8D56\r\n        let depsMap = targetMap.get(target) // \u83B7\u53D6\u5BF9\u8C61\u7684\u4F9D\u8D56\r\n        if (!depsMap) { // \u6CA1\u6709\u4F9D\u8D56\u5C31\u521B\u5EFA\u4E00\u4E2A\r\n            targetMap.set(target, depsMap = new Map()) // \u521B\u5EFA\u5BF9\u8C61\u7684\u4F9D\u8D56\r\n        }\r\n        let dep = depsMap.get(key) // \u83B7\u53D6\u5C5E\u6027\u7684\u4F9D\u8D56           \r\n        if (!dep) { // \u6CA1\u6709\u4F9D\u8D56\u5C31\u521B\u5EFA\u4E00\u4E2A\r\n            depsMap.set(\r\n                key, \r\n                dep = createDep(() => depsMap.delete(key), key) // \u521B\u5EFA\u5C5E\u6027\u7684\u4F9D\u8D56\r\n            )\r\n        }\r\n        trackEffects(activeEffect,dep) // \u6536\u96C6\u4F9D\u8D56\r\n    }else {\r\n        return false\r\n    }\r\n}\r\n\r\nexport function trigger(target,key){\r\n    const depsMap = targetMap.get(target) // \u83B7\u53D6\u5BF9\u8C61\u7684\u4F9D\u8D56\r\n    if(!depsMap) return false; // \u6CA1\u6709\u4F9D\u8D56\u76F4\u63A5\u8FD4\u56DE\r\n    const dep = depsMap.get(key) // \u83B7\u53D6\u5C5E\u6027\u7684\u4F9D\u8D56\r\n    if(!dep) return false; // \u6CA1\u6709\u4F9D\u8D56\u76F4\u63A5\u8FD4\u56DE  \r\n    triggerEffect(dep) // \u89E6\u53D1\u66F4\u65B0\r\n}\r\n", "import { track, trigger } from \"./reactiveEffect\";\r\n\r\nexport enum ReactiveFlags { // \u54CD\u5E94\u5F0F\u6807\u8BC6\r\n    IS_REACTIVE = '__v_isReactive'\r\n}\r\nexport const mutabaleHandlers: ProxyHandler<object> ={\r\n    get(target,key,receiver){\r\n        if(key === ReactiveFlags.IS_REACTIVE){ // \u5224\u65AD\u662F\u5426\u662F\u54CD\u5E94\u5F0F\u5BF9\u8C61\r\n            return true\r\n        }\r\n        // \u4F9D\u8D56\u6536\u96C6\r\n        track(target,key)\r\n        return Reflect.get(target,key,receiver) // \u901A\u8FC7Reflect\u83B7\u53D6\u503C\r\n    },\r\n    set(target,key,value,recetiver){ // \u8BBE\u7F6E\u503C\r\n        // \u89E6\u53D1\u66F4\u65B0\r\n        const oldValue = target[key]\r\n        const result = Reflect.set(target,key,value,recetiver) // \u901A\u8FC7Reflect\u8BBE\u7F6E\u503C\r\n        if(oldValue !== value){\r\n            trigger(target,key) // \u89E6\u53D1\u66F4\u65B0\r\n        }\r\n        return result\r\n    }\r\n}", "import { isObject } from \"@vue/shared\";\r\nimport { mutabaleHandlers, ReactiveFlags } from \"./baseHandle\";\r\nconst reactiveMap = new WeakMap(); // key:target value:proxy\r\n\r\n\r\nexport function reactive(target) { // \u54CD\u5E94\u5F0F\u51FD\u6570\r\n    return createReactive(target);\r\n}\r\nfunction createReactive(target) { // \u521B\u5EFA\u54CD\u5E94\u5F0F\u51FD\u6570\r\n    !isObject && target // \u4E0D\u662F\u5BF9\u8C61\u76F4\u63A5\u8FD4\u56DE\r\n    target[ReactiveFlags.IS_REACTIVE] && target // \u5DF2\u7ECF\u662F\u54CD\u5E94\u5F0F\u5BF9\u8C61\u76F4\u63A5\u8FD4\u56DE\r\n\r\n    const existingProxy = reactiveMap.get(target) // \u5DF2\u7ECF\u88AB\u4EE3\u7406\u8FC7\u76F4\u63A5\u8FD4\u56DE\r\n    existingProxy && existingProxy // \u7F13\u5B58\u4E2D\u6709\u76F4\u63A5\u8FD4\u56DE\r\n\r\n    const proxy = new Proxy(target, mutabaleHandlers) // \u521B\u5EFA\u4EE3\u7406\r\n    reactiveMap.set(target, proxy) // \u7F13\u5B58\u4EE3\u7406\r\n    return proxy // \u8FD4\u56DE\u4EE3\u7406\r\n}"],
  "mappings": ";AAAO,SAAS,SAAS,OAAM;AAC3B,SAAO,OAAO,UAAU,YAAY,UAAU;AAClD;;;ACFA,IAAM,iBAAN,MAAqB;AAAA;AAAA,EAKjB,YAAmB,IAAW,WAAY;AAAvB;AAAW;AAJ9B,SAAO,SAAS;AAChB;AAAA,SAAO,WAAW;AAClB;AAAA,SAAO,cAAc;AACrB;AAAA,SAAO,OAAO,CAAC;AAAA,EAC6B;AAAA,EAC5C,MAAM;AACF,QAAI,CAAC,KAAK,OAAQ,MAAK,GAAG;AAC1B,QAAI,mBAAmB;AACvB,QAAI;AACA,qBAAe;AACf,uBAAiB,IAAI;AACrB,aAAO,KAAK,GAAG;AAAA,IACnB,UAAE;AACE,qBAAe;AAAA,IACnB;AAAA,EACJ;AACJ;AAEA,SAAS,iBAAiBA,SAAQ;AAC9B,EAAAA,QAAO,cAAc;AACrB,EAAAA,QAAO;AACX;AAEA,SAAS,YAAY,KAAKA,SAAQ;AAC9B,MAAI,OAAOA,OAAM;AACjB,MAAG,IAAI,SAAS,EAAG,KAAI,SAAS;AAEpC;AAEO,IAAI;AACJ,SAAS,OAAO,IAAc,SAAU;AAC3C,QAAM,UAAU,IAAI,eAAe,IAAI,MAAM;AACzC,YAAQ,IAAI;AAAA,EAChB,CAAC;AACD,UAAQ,IAAI;AAChB;AAEO,SAAS,aAAaA,SAAQ,KAAK;AACtC,MAAG,IAAI,IAAIA,OAAM,MAAIA,QAAO,UAAS;AACjC,QAAI,IAAIA,SAAOA,QAAO,QAAQ;AAC9B,UAAM,SAASA,QAAO,KAAKA,QAAO,WAAW;AAC7C,QAAG,WAAW,KAAI;AACd,UAAG,QAAO;AACN,oBAAY,QAAOA,OAAM;AAAA,MAC7B;AACA,MAAAA,QAAO,KAAKA,QAAO,aAAa,IAAI;AAAA,IACxC,OAAK;AACD,MAAAA,QAAO;AAAA,IACX;AAAA,EACJ;AACJ;AAEO,SAAS,cAAc,KAAK;AAC/B,aAAWA,WAAU,IAAI,KAAK,GAAG;AAC7B,IAAAA,QAAO,aAAaA,QAAO,UAAU;AAAA,EACzC;AACJ;;;ACvDA,IAAM,YAAY,oBAAI,QAAQ;AAEvB,IAAO,YAAY,CAAC,UAAS,QAAO;AACvC,QAAM,MAAM,oBAAI,IAAI;AACpB,MAAI,WAAW;AACf,MAAI,OAAO;AACX,SAAO;AACX;AACO,SAAS,MAAM,QAAQ,KAAK;AAC/B,MAAI,cAAc;AACd,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAI,CAAC,SAAS;AACV,gBAAU,IAAI,QAAQ,UAAU,oBAAI,IAAI,CAAC;AAAA,IAC7C;AACA,QAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,QAAI,CAAC,KAAK;AACN,cAAQ;AAAA,QACJ;AAAA,QACA,MAAM,UAAU,MAAM,QAAQ,OAAO,GAAG,GAAG,GAAG;AAAA;AAAA,MAClD;AAAA,IACJ;AACA,iBAAa,cAAa,GAAG;AAAA,EACjC,OAAM;AACF,WAAO;AAAA,EACX;AACJ;AAEO,SAAS,QAAQ,QAAO,KAAI;AAC/B,QAAM,UAAU,UAAU,IAAI,MAAM;AACpC,MAAG,CAAC,QAAS,QAAO;AACpB,QAAM,MAAM,QAAQ,IAAI,GAAG;AAC3B,MAAG,CAAC,IAAK,QAAO;AAChB,gBAAc,GAAG;AACrB;;;AC9BO,IAAM,mBAAwC;AAAA,EACjD,IAAI,QAAO,KAAI,UAAS;AACpB,QAAG,QAAQ,oCAA0B;AACjC,aAAO;AAAA,IACX;AAEA,UAAM,QAAO,GAAG;AAChB,WAAO,QAAQ,IAAI,QAAO,KAAI,QAAQ;AAAA,EAC1C;AAAA,EACA,IAAI,QAAO,KAAI,OAAM,WAAU;AAE3B,UAAM,WAAW,OAAO,GAAG;AAC3B,UAAM,SAAS,QAAQ,IAAI,QAAO,KAAI,OAAM,SAAS;AACrD,QAAG,aAAa,OAAM;AAClB,cAAQ,QAAO,GAAG;AAAA,IACtB;AACA,WAAO;AAAA,EACX;AACJ;;;ACrBA,IAAM,cAAc,oBAAI,QAAQ;AAGzB,SAAS,SAAS,QAAQ;AAC7B,SAAO,eAAe,MAAM;AAChC;AACA,SAAS,eAAe,QAAQ;AAC5B,GAAC,YAAY;AACb,2CAAgC,KAAK;AAErC,QAAM,gBAAgB,YAAY,IAAI,MAAM;AAC5C,mBAAiB;AAEjB,QAAM,QAAQ,IAAI,MAAM,QAAQ,gBAAgB;AAChD,cAAY,IAAI,QAAQ,KAAK;AAC7B,SAAO;AACX;",
  "names": ["effect"]
}
